import {v4 as UUID} from 'uuid';
import {PentestStatus} from '@shared/models/pentest-status.model';
import {Category} from '@shared/models/category.model';

export class Pentest {
  id?: string;
  category: Category;
  refNumber: string;
  childEntries?: Pentest[];
  status: PentestStatus;
  findingsIds?: Array<string>;
  commentsIds?: Array<string>;

  constructor(category: Category,
              refNumber: string,
              status: PentestStatus,
              id?: string,
              findingsIds?: Array<string>,
              commentsIds?: Array<string>) {
    this.id = id ? id : UUID();
    this.category = category;
    this.refNumber = refNumber;
    this.status = status;
    this.findingsIds = findingsIds ? findingsIds : [];
    this.commentsIds = commentsIds ? commentsIds : [];
  }
}

export interface ObjectiveEntry {
  refNumber: string;
  status: string;
  findings?: number;
  kind?: string;
  childEntries?: ObjectiveEntry[];
  expanded?: boolean;
}

export function transformPentestsToObjectiveEntries(pentests: Pentest[]): ObjectiveEntry[] {
  const objectiveEntries: ObjectiveEntry[] = [];
  pentests.forEach((value: Pentest) => {
    objectiveEntries.push({
      refNumber: value.refNumber,
      status: value.status,
      findings: value.findingsIds ? value.findingsIds.length : 0,
      kind: value.childEntries ? 'dir' : 'cell',
      childEntries: value.childEntries ? value.childEntries : null,
      expanded: !!value.childEntries
    } as ObjectiveEntry);
  });
  return objectiveEntries;
}
